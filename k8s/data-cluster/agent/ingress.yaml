apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: amicable-agent
  namespace: amicable
  annotations:
    traefik.ingress.kubernetes.io/router.entrypoints: websecure
    # Force ALPN http/1.1 for this host so browser WebSockets (HTTP/1.1 Upgrade)
    # can connect even when Traefik would otherwise negotiate h2-only.
    traefik.ingress.kubernetes.io/router.tls.options: "amicable-agent-http1@kubernetescrd"
    cert-manager.io/cluster-issuer: letsencrypt-intern-dns
spec:
  ingressClassName: traefik
  tls:
    - hosts:
        - amicable-agent.data.mayflower.zone
      secretName: amicable-agent-tls
  rules:
    - host: amicable-agent.data.mayflower.zone
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: amicable-agent
                port:
                  number: 80
