# Default values for amicable.

sandboxNamespace: amicable

images:
  agent:
    repository: ghcr.io/mayflower/amicable-agent
    tag: main
    pullPolicy: IfNotPresent
  sandbox:
    repository: ghcr.io/mayflower/amicable-sandbox
    tag: main
    pullPolicy: IfNotPresent
  editor:
    repository: ghcr.io/mayflower/amicable-editor
    tag: main
    pullPolicy: IfNotPresent

sandboxTemplate:
  # Fallback template name used by the agent if a project template id is unknown.
  # This should match one of the sandboxTemplates names when sandboxTemplates is set.
  name: amicable-sandbox-vite
  additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
  # Optional: set a RuntimeClass for sandbox pods (example: "gvisor").
  # This must exist in the cluster as a RuntimeClass object.
  runtimeClassName: ""

# Optional: define multiple SandboxTemplates (one per app template).
# If set, deploy/helm/amicable/templates/sandbox/sandbox-template.yaml will render one
# SandboxTemplate resource per entry.
sandboxTemplates:
  - name: amicable-sandbox-vite
    image:
      repository: ghcr.io/mayflower/amicable-sandbox-vite
      tag: main
      pullPolicy: IfNotPresent
    additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
    runtimeClassName: ""
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"
  - name: amicable-sandbox-nextjs15
    image:
      repository: ghcr.io/mayflower/amicable-sandbox-nextjs15
      tag: main
      pullPolicy: IfNotPresent
    additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
    runtimeClassName: ""
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "2Gi"
  - name: amicable-sandbox-fastapi
    image:
      repository: ghcr.io/mayflower/amicable-sandbox-fastapi
      tag: main
      pullPolicy: IfNotPresent
    additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
    runtimeClassName: ""
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"
  - name: amicable-sandbox-hono
    image:
      repository: ghcr.io/mayflower/amicable-sandbox-hono
      tag: main
      pullPolicy: IfNotPresent
    additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
    runtimeClassName: ""
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"
  - name: amicable-sandbox-remix
    image:
      repository: ghcr.io/mayflower/amicable-sandbox-remix
      tag: main
      pullPolicy: IfNotPresent
    additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
    runtimeClassName: ""
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"
  - name: amicable-sandbox-nuxt3
    image:
      repository: ghcr.io/mayflower/amicable-sandbox-nuxt3
      tag: main
      pullPolicy: IfNotPresent
    additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
    runtimeClassName: ""
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"
  - name: amicable-sandbox-sveltekit
    image:
      repository: ghcr.io/mayflower/amicable-sandbox-sveltekit
      tag: main
      pullPolicy: IfNotPresent
    additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
    runtimeClassName: ""
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"
  - name: amicable-sandbox-laravel
    image:
      repository: ghcr.io/mayflower/amicable-sandbox-laravel
      tag: main
      pullPolicy: IfNotPresent
    additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
    runtimeClassName: ""
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"
  - name: amicable-sandbox-flutter
    image:
      repository: ghcr.io/mayflower/amicable-sandbox-flutter
      tag: main
      pullPolicy: IfNotPresent
    additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
    runtimeClassName: ""
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "2Gi"
  - name: amicable-sandbox-phoenix
    image:
      repository: ghcr.io/mayflower/amicable-sandbox-phoenix
      tag: main
      pullPolicy: IfNotPresent
    additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
    runtimeClassName: ""
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"
  - name: amicable-sandbox-aspnetcore
    image:
      repository: ghcr.io/mayflower/amicable-sandbox-aspnetcore
      tag: main
      pullPolicy: IfNotPresent
    additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
    runtimeClassName: ""
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"
  - name: amicable-sandbox-quarkus
    image:
      repository: ghcr.io/mayflower/amicable-sandbox-quarkus
      tag: main
      pullPolicy: IfNotPresent
    additionalAllowedHosts: ".amicable-preview.data.mayflower.tech"
    runtimeClassName: ""
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "1Gi"

# Optional warm pools to reduce sandbox cold-start latency.
# Requires SandboxWarmPool CRD from agent-sandbox extensions.
sandboxWarmPools:
  enabled: false
  pools:
    - name: amicable-sandbox-vite
      templateName: amicable-sandbox-vite
      replicas: 1
    - name: amicable-sandbox-nextjs15
      templateName: amicable-sandbox-nextjs15
      replicas: 1
    - name: amicable-sandbox-fastapi
      templateName: amicable-sandbox-fastapi
      replicas: 1
    - name: amicable-sandbox-hono
      templateName: amicable-sandbox-hono
      replicas: 1
    - name: amicable-sandbox-remix
      templateName: amicable-sandbox-remix
      replicas: 1
    - name: amicable-sandbox-nuxt3
      templateName: amicable-sandbox-nuxt3
      replicas: 1
    - name: amicable-sandbox-sveltekit
      templateName: amicable-sandbox-sveltekit
      replicas: 1
    - name: amicable-sandbox-laravel
      templateName: amicable-sandbox-laravel
      replicas: 1
    - name: amicable-sandbox-flutter
      templateName: amicable-sandbox-flutter
      replicas: 1
    - name: amicable-sandbox-phoenix
      templateName: amicable-sandbox-phoenix
      replicas: 1
    - name: amicable-sandbox-aspnetcore
      templateName: amicable-sandbox-aspnetcore
      replicas: 1
    - name: amicable-sandbox-quarkus
      templateName: amicable-sandbox-quarkus
      replicas: 1

agent:
  replicas: 2
  service:
    port: 80
  ingress:
    enabled: true
    ingressClassName: traefik
    host: amicable-agent.data.mayflower.tech
    certIssuer: letsencrypt-intern-dns
    tls:
      enabled: true
      secretName: amicable-agent-tls
    traefik:
      forceHttp1:
        # If enabled, render a Traefik TLSOption with ALPN "http/1.1" only and
        # attach it to the agent Ingress. This is necessary for browser WebSockets
        # if the host would otherwise negotiate h2-only via ALPN.
        enabled: false
        tlsOptionName: amicable-agent-http1
  env:
    previewBaseDomain: amicable-preview.data.mayflower.tech
    previewScheme: https
    runtimePort: "8888"
    previewPort: "3000"
    runtimeReadyTimeoutS: "5"
    runtimeReadyPollMs: "250"
    # Whether Git sync is required. In production: "1". For local dev: "0".
    gitSyncRequired: "1"
    # Additional env vars passed directly to the agent container.
    # Preview router resolver (optional but recommended):
    #   PREVIEW_RESOLVER_TOKEN: "<shared-token>"
    # Example (Google OAuth):
    #   AUTH_MODE: "google"
    #   PUBLIC_BASE_URL: "https://amicable-agent.data.mayflower.tech"
    #   CORS_ALLOW_ORIGINS: "https://amicable.data.mayflower.tech"
    #   AUTH_REDIRECT_ALLOW_ORIGINS: "https://amicable.data.mayflower.tech"
    # Langfuse (non-secret values):
    #   LANGFUSE_PUBLIC_KEY: "pk-lf-..."
    #   LANGFUSE_BASE_URL: "https://langfuse.mayflower.cloud"
    # OpenInference / OTEL tracing (staging-first rollout):
    #   AMICABLE_OTEL_ENABLED: "1"
    #   OTEL_EXPORTER_OTLP_TRACES_ENDPOINT: "http://monitoring-stack-alloy.monitoring.svc.cluster.local:4318/v1/traces"
    #   OTEL_SERVICE_NAME: "amicable-agent-staging"
    #   OTEL_RESOURCE_ATTRIBUTES: "service.namespace=amicable,deployment.environment=staging"
    #   OPENINFERENCE_HIDE_INPUT_TEXT: "true"
    #   OPENINFERENCE_HIDE_OUTPUT_TEXT: "true"
    #   OPENINFERENCE_HIDE_INPUT_IMAGES: "true"
    extra: {}
  secret:
    name: amicable-agent-secrets
    openaiApiKeyKey: OPENAI_API_KEY
    # Required GitLab token for project persistence (repo create/sync/delete).
    gitlabTokenKey: GITLAB_TOKEN
    # Map of env var name -> key in the same Kubernetes secret.
    # Example:
    #   # Persist LangGraph checkpoints (DeepAgents session history) across agent restarts:
    #   AMICABLE_LANGGRAPH_DATABASE_URL: AMICABLE_LANGGRAPH_DATABASE_URL
    #   GOOGLE_CLIENT_ID: GOOGLE_CLIENT_ID
    #   GOOGLE_CLIENT_SECRET: GOOGLE_CLIENT_SECRET
    #   SESSION_SECRET: SESSION_SECRET
    #   LANGFUSE_SECRET_KEY: LANGFUSE_SECRET_KEY
    extraEnv: {}

previewRouter:
  replicas: 2
  service:
    port: 80
  ingress:
    enabled: true
    ingressClassName: traefik
    wildcardHost: "*.amicable-preview.data.mayflower.tech"
    certIssuer: letsencrypt-intern-dns
    tls:
      enabled: true
      secretName: amicable-preview-wildcard-tls

editor:
  enabled: false
  replicas: 2
  service:
    port: 80
  ingress:
    enabled: true
    ingressClassName: traefik
    host: amicable.data.mayflower.tech
    certIssuer: letsencrypt-intern-dns
    tls:
      enabled: true
      secretName: amicable-editor-tls
  runtimeConfig:
    # These are injected into /config.js and read by frontend/src/config/agent.ts at runtime.
    VITE_AGENT_WS_URL: "wss://amicable-agent.data.mayflower.tech/"
    # Note: this value is delivered to the browser, so it is not a real "secret".
    # If you need access control, enforce auth at the ingress (OIDC/basic auth) or
    # put the editor behind your SSO.
